<html>
  <head>
    <script src="/build/graphToD3.web.js"></script>
    <script src="/build/perspective.web.js"></script>
    <style>
      #dropContainer {
        /* position: fixed;
        background-color:white; */

        position: absolute;
        top: 0px;
        left: 0px;
        width: 1500px;
        height: 1200px;
        border: 1px solid red;
        transform-origin: 0 0;
        -webkit-transform-origin: 0 0;
        -moz-transform-origin: 0 0;
        -o-transform-origin: 0 0;
      }
      body {
        background: url("/resources/table.JPG");
        background-size: 100%;
      }
    </style>
  </head>
  <body>
    <div id="dropContainer"></div>
    <script>

    let container = document.querySelector("#dropContainer");
    let plot;
    plot = graphToD3(container, "/resources/Drops.svg", {
      xRay: false,
      width: 1400,
      height: 800,
      margin: 0,
      nodeRadius: 100,
      bandwidth: 10,
      threshold: 0.009,
      noHover: true,
      noFixed: true,
      linkStrength: 1.4,
      borderPoints: 60,
      scale: 0.05,
      internalPoints: 50,
      distanceModifier: 1000,
      maxEdgeDistance: 200,
      zoom: 0.8
    });

    perspective(container);

    window.plot = plot;

    let x = 100, y = 100;

    let drops = {
      0: {x, y, group: 0},
      1: {x, y, group: 1},
      2: {x, y, group: 2},
      3: {x, y, group: 3},
      4: {x, y, group: 4},
      5: {x, y, group: 5},
      6: {x, y, group: 6},
      7: {x, y, group: 7},
      8: {x, y, group: 8},
      9: {x, y, group: 9}
    };

    let drop;

    document.addEventListener('node-clicked', function (e) {
      drop = drops[e.data.group];
    }, false);

    document.addEventListener("keyup", (e)=> {
      let strength = 0.9;
      let radius = 0.1;
      let stride = 800;
      let timeout = 500;
      let objectIndex = 0;

      switch(e.key) {
        case "a":
        case "d":
        case "s":
        case "w":
        objectIndex = 1;
        break;
      }

      switch(e.key) {
        case "a":
        case "ArrowLeft":
          drop.x -= stride;
          break;
        case "d":
        case "ArrowRight":
          drop.x += stride;
          break;
        case "w":
        case "ArrowUp":
          drop.y -= stride;
          break;
        case "s":
        case "ArrowDown":
          drop.y += stride;
          break;
      }
      plot.forceAtPoint(drop.x, drop.y, {strength, radius, timeout:-1, group: drop.group});
    });

    </script>
  </body>
</html>
